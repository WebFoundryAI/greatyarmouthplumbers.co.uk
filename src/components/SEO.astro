---
export interface Props {
  title: string;
  description: string;
  canonicalUrl?: string;
  ogImage?: string;
  schema?: Record<string, unknown> | Record<string, unknown>[];
  noindex?: boolean;
}

const SITE_NAME = 'Great Yarmouth Plumbers';

const {
  title: rawTitle,
  description,
  canonicalUrl,
  // TODO: Create /public/images/og-default.webp (1200x630px) for social sharing previews
  ogImage = '/images/og-default.webp',
  schema,
  noindex = false,
} = Astro.props;

/* Auto-append business name if not already present and title stays under 60 chars */
const MAX_TITLE_LENGTH = 60;
const withBrand = `${rawTitle} | ${SITE_NAME}`;
const title = rawTitle.includes(SITE_NAME)
  ? rawTitle
  : withBrand.length <= MAX_TITLE_LENGTH
    ? withBrand
    : rawTitle;

const canonical = canonicalUrl || Astro.url.href;
const ogImageUrl = ogImage.startsWith('http')
  ? ogImage
  : new URL(ogImage, Astro.site).href;
---

<!-- Primary meta -->
<title>{title}</title>
<meta name="description" content={description} />
<link rel="canonical" href={canonical} />
{noindex && <meta name="robots" content="noindex,nofollow" />}

<!-- Open Graph -->
<meta property="og:type" content="website" />
<meta property="og:title" content={title} />
<meta property="og:description" content={description} />
<meta property="og:url" content={canonical} />
<meta property="og:image" content={ogImageUrl} />
<meta property="og:site_name" content={SITE_NAME} />
<meta property="og:locale" content="en_GB" />

<!-- Twitter Card -->
<meta name="twitter:card" content="summary_large_image" />
<meta name="twitter:title" content={title} />
<meta name="twitter:description" content={description} />
<meta name="twitter:image" content={ogImageUrl} />

<!-- Geo meta tags for local SEO -->
<meta name="geo.region" content="GB-NFK" />
<meta name="geo.placename" content="Great Yarmouth" />
<meta name="geo.position" content="52.6039;1.7278" />
<meta name="ICBM" content="52.6039, 1.7278" />

<!-- JSON-LD structured data -->
{schema && (
  <script
    type="application/ld+json"
    set:html={JSON.stringify(schema)}
  />
)}
